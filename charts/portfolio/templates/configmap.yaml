apiVersion: v1
data:
    default.conf: |
      server {
          listen 80;
          server_name localhost;

          location /static/ {
              alias /var/www/static/;
              expires 30d;
              add_header Cache-Control "public, immutable";
              autoindex on;
          }

          location /media/ {
              alias /var/www/media/;
              expires 30d;
              add_header Cache-Control "public, immutable";
              autoindex on;
          }

          location / {
              proxy_pass http://localhost:8000;
              proxy_set_header Host $host;
              proxy_set_header X-Real-IP $remote_addr;
              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
              proxy_set_header X-Forwarded-Proto $scheme;
              
              proxy_connect_timeout 60s;
              proxy_send_timeout 60s;
              proxy_read_timeout 60s;
              
              proxy_buffering on;
              proxy_buffer_size 4k;
              proxy_buffers 8 4k;
          }

          location /health {
              access_log off;
              return 200 "healthy\n";
              add_header Content-Type text/plain;
          }
      }
kind: ConfigMap
metadata:
  creationTimestamp: null
  name: nginx-config
---
apiVersion: v1
data:
  {{- with .Values.configmap }}
        {{- toYaml . | nindent 2 }}
  {{- end }}
kind: ConfigMap
metadata:
  creationTimestamp: null
  name: {{ include "portfolio.fullname" . }}-cm
